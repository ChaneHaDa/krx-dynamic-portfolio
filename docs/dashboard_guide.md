# Streamlit 대시보드 사용 가이드

> **KRX Dynamic Portfolio** Phase 4 - 인터랙티브 웹 대시보드

## 📋 목차

1. [대시보드 개요](#대시보드-개요)
2. [시작하기](#시작하기)
3. [페이지별 기능](#페이지별-기능)
4. [실시간 데이터 연동](#실시간-데이터-연동)
5. [사용자 인터페이스](#사용자-인터페이스)
6. [문제 해결](#문제-해결)
7. [기술적 한계](#기술적-한계)

---

## 🎯 대시보드 개요

KRX Dynamic Portfolio 대시보드는 Streamlit 기반의 인터랙티브 웹 애플리케이션으로, 포트폴리오 관리의 모든 단계를 시각화하고 제어할 수 있는 통합 인터페이스를 제공합니다.

### 주요 특징
- **5개 전용 페이지**: 홈, 최적화, 백테스팅, 리스크분석, 데이터관리
- **실시간 시장 데이터**: yfinance API를 통한 KOSPI 지수 및 주가 정보
- **10+ 차트 컴포넌트**: 인터랙티브 시각화 (Plotly 기반)
- **반응형 레이아웃**: 다양한 화면 크기에 최적화
- **스마트 캐싱**: 15분~1시간 주기로 데이터 자동 갱신

---

## 🚀 시작하기

### 1. 대시보드 실행

```bash
# 가상환경 활성화
source venv/bin/activate

# Streamlit 대시보드 실행
streamlit run krx_portfolio/app/dashboard.py

# 또는 Makefile 사용
make app
```

### 2. 브라우저 접속

대시보드 실행 후 자동으로 브라우저가 열리거나, 다음 URL로 직접 접속:

```
Local URL: http://localhost:8501
Network URL: http://[your-ip]:8501
```

### 3. 초기 설정

대시보드 첫 실행 시:
1. **데이터 확인**: 샘플 데이터로 기능 확인
2. **ETL 설정**: 실제 KRX 데이터 경로 설정 (선택사항)
3. **최적화 파라미터**: 기본 설정 확인 및 조정

---

## 📄 페이지별 기능

### 1. 🏠 홈 페이지

**실시간 시장 현황**
- KOSPI 지수 실시간 가격 및 변동률
- 시장 거래 상태 (장중/장마감)
- 시스템 상태 및 테스트 통계

**시스템 개요**
- 전체 모듈 현황 (ETL, 최적화, 백테스팅)
- 빠른 시작 가이드
- 개발 진행 상황

```python
# 홈 페이지에서 제공하는 정보
- 현재 KOSPI 지수
- 전일 대비 변동률
- 시장 개장/폐장 상태
- 테스트 통과율 (193/210)
- 코드 커버리지 (65%)
```

### 2. 📈 포트폴리오 최적화 페이지

**최적화 설정**
- **최적화 방법**: Max Sharpe, Min Variance, Mean-Variance
- **리스크 모델**: Sample, Ledoit-Wolf, OAS, EWMA
- **제약 조건**: 최대 비중, 과거 데이터 기간

**결과 시각화**
- 포트폴리오 구성 테이블 (종목코드, 비중, 예상수익률)
- 자산 배분 파이 차트
- 리스크-수익률 메트릭

```python
# 최적화 파라미터 예시
optimization_config = {
    "method": "max_sharpe",           # 최적화 방법
    "risk_model": "ledoit_wolf",      # 리스크 모델
    "max_weight": 0.10,               # 최대 비중 10%
    "lookback_days": 252              # 1년 과거 데이터
}
```

### 3. 📊 백테스팅 페이지

**백테스팅 설정**
- **기간 설정**: 시작일, 종료일
- **자본 및 비용**: 초기 자본, 거래비용
- **리밸런싱**: 주기, 벤치마크

**성과 분석**
- 누적 수익률 차트 (시계열)
- 성과 지표 메트릭 (총수익률, 샤프비율, 최대낙폭 등)
- 벤치마크 대비 성과 비교

```python
# 백테스팅 결과 예시
performance_metrics = {
    "total_return": 0.245,           # 총 수익률 24.5%
    "annualized_return": 0.078,      # 연평균 수익률 7.8%  
    "sharpe_ratio": 0.85,            # 샤프 비율
    "max_drawdown": -0.082,          # 최대 낙폭 -8.2%
    "volatility": 0.153              # 변동성 15.3%
}
```

### 4. ⚠️ 리스크 분석 페이지

**리스크 지표**
- **VaR/CVaR**: 95% 신뢰구간 손실 위험
- **추적 오차**: 벤치마크 대비 편차
- **하방 편차**: 하방 위험 측정
- **최대 낙폭**: 기간 및 복구 기간

**리스크 시각화**
- 수익률 분포 히스토그램
- VaR 경계선 표시
- 극값 분석 차트

```python
# 리스크 지표 예시
risk_metrics = {
    "var_95": -0.021,                # VaR 95% = -2.1%
    "cvar_95": -0.032,               # CVaR 95% = -3.2%
    "tracking_error": 0.018,         # 추적 오차 1.8%
    "downside_deviation": 0.089,     # 하방 편차 8.9%
    "max_drawdown_days": 23,         # 최대 낙폭 기간 23일
    "recovery_days": 45              # 복구 기간 45일
}
```

### 5. 📋 데이터 관리 페이지

**ETL 파이프라인 제어**
- KRX 데이터 수집 및 전처리 실행
- 데이터 품질 리포트
- 캐시 관리 및 정리

**시스템 모니터링**
- 데이터 처리 상태
- 마지막 업데이트 시점
- 저장 공간 사용량

---

## 🔄 실시간 데이터 연동

### yfinance API 통합

대시보드는 **yfinance** 라이브러리를 통해 실시간 금융 데이터를 제공합니다:

```python
# 지원하는 실시간 데이터
- KOSPI 지수 (^KS11)
- KOSDAQ 지수 (^KQ11)  
- 개별 종목 (종목코드.KS 형식)
- 해외 지수 (S&P500, NASDAQ)
```

### 캐싱 전략

효율적인 데이터 관리를 위한 계층화된 캐싱:

```python
@st.cache_data(ttl=3600)    # 1시간: 과거 데이터
@st.cache_data(ttl=900)     # 15분: 현재 가격
@st.cache_data(ttl=300)     # 5분: 시장 상태
```

### 데이터 변환

KRX 종목코드를 yfinance 심볼로 자동 변환:

```python
# 변환 예시
"005930" → "005930.KS"  # 삼성전자
"035420" → "035420.KS"  # NAVER
```

---

## 🎨 사용자 인터페이스

### 레이아웃 구조

```
📱 대시보드 레이아웃
├── 🔧 사이드바: 페이지 네비게이션
├── 📊 메인 영역: 선택된 페이지 컨텐츠
│   ├── 📈 메트릭 카드: 주요 지표 표시
│   ├── 📋 데이터 테이블: 상세 데이터
│   ├── 📊 차트 영역: 인터랙티브 시각화
│   └── ⚙️ 제어 패널: 설정 및 실행
└── 📝 상태 표시: 진행 상황 및 알림
```

### 지원하는 차트 유형

1. **파이 차트**: 포트폴리오 구성, 섹터 배분
2. **선 차트**: 누적 수익률, 시계열 성과
3. **막대 차트**: 섹터별 성과, 기여도 분석
4. **산점도**: 위험-수익률 분포
5. **히스토그램**: 수익률 분포, 리스크 분석
6. **히트맵**: 상관관계, 리스크 매트릭스
7. **영역 차트**: 드로다운, 누적 기여도
8. **박스 플롯**: 수익률 분포, 아웃라이어 분석
9. **캔들스틱**: 가격 차트 (추후 지원 예정)
10. **서브플롯**: 다중 지표 동시 표시

### 반응형 디자인

- **컬럼 레이아웃**: 화면 크기에 따른 자동 조정
- **확장 가능한 섹션**: 상세 정보 접기/펼치기
- **스크롤 최적화**: 긴 테이블 및 차트 처리
- **모바일 호환**: 태블릿 및 스마트폰 지원

---

## 🔧 문제 해결

### 일반적인 오류

**1. Import 오류**
```bash
ImportError: cannot import name 'run_portfolio_optimization'
```
**해결방법**: 올바른 클래스/함수명 확인 후 import 수정

**2. 데이터 연결 실패**
```bash
yfinance API timeout or connection error
```
**해결방법**: 인터넷 연결 확인, 프록시 설정 점검

**3. 메모리 부족**
```bash
MemoryError: Unable to allocate array
```
**해결방법**: 데이터 크기 축소, 배치 처리 적용

### 성능 최적화

**대용량 데이터 처리**:
```python
# 데이터 샘플링
data = data.sample(n=1000)  # 1000개 샘플만 사용

# 청크 단위 처리  
for chunk in pd.read_csv('large_file.csv', chunksize=1000):
    process_chunk(chunk)
```

**캐시 최적화**:
```python
# 캐시 초기화
st.cache_data.clear()

# 메모리 사용량 모니터링
st.write(f"Memory usage: {psutil.virtual_memory().percent}%")
```

### 로그 및 디버깅

**로그 설정**:
```python
import logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)
```

**Streamlit 디버그 모드**:
```bash
streamlit run app.py --logger.level=debug
```

---

## ⚠️ 기술적 한계

### 현재 제한사항

1. **테스트 부족**: 대시보드 모듈 0% 커버리지
2. **실시간 데이터**: yfinance API 속도 제한 (분당 요청 한도)
3. **데이터 정확성**: 실시간 데이터의 지연 시간 (15분~1시간)
4. **확장성**: 대용량 포트폴리오 처리 시 성능 이슈 가능
5. **브라우저 호환성**: 최신 브라우저 권장

### 알려진 이슈

1. **백테스팅 결과 내보내기**: parquet 직렬화 오류
2. **극단적 케이스 처리**: 0 변동성, 빈 데이터 등
3. **실시간 업데이트**: 수동 새로고침 필요
4. **메모리 누수**: 장시간 실행 시 메모리 사용량 증가

### 향후 개선 계획

1. **📊 UI 테스트 추가**: Selenium 기반 자동화 테스트
2. **🔄 실시간 스트리밍**: WebSocket 기반 실시간 업데이트  
3. **📱 모바일 최적화**: PWA 지원, 터치 인터페이스
4. **🛡️ 오류 처리**: Graceful degradation, 대체 데이터 소스
5. **🚀 성능 향상**: 데이터 압축, 지연 로딩, CDN 적용

---

## 📞 지원 및 문의

- **GitHub Issues**: 버그 리포트 및 기능 요청
- **문서**: `docs/` 디렉토리의 추가 가이드 참조
- **코드 예시**: `examples/` 디렉토리 (추후 추가 예정)

---

**📝 문서 버전**: v1.0.0  
**📅 마지막 업데이트**: 2025-08-29  
**✍️ 작성자**: KRX Dynamic Portfolio Team